@page
@using ItTakesAVillage.Contracts
@inject IGroupService _groupService
@model ItTakesAVillage.Pages.GroupModel
@{

}
@if (Model.CurrentUser != null)
{


    <div class="row d-flex m-5">
        <h2 class="text-center abrilFont">Samla dina vänner och börja hjälpas åt!</h2>
    </div>
    <div class="greenBgColor p-5">
        <div class="container w-75">
            <h4 class="mt-2 mb-5 abrilFont">Kom igång idag och skapa en grupp!</h4>
            <form method="post" asp-page-handler="NewGroup">
                <label class="form-label abrilFont d-block">Ange gruppens namn</label>
                <div class="d-flex w-50 gap-2">
                    <input required
                           class="col-10 form-control bg-transparent"
                           placeholder="Ange gruppnamn"
                           asp-for="NewGroup.Name" />
                    <input type="submit" class="btn col-2 pinkBgColor fw-bold" value="Spara" />
                </div>


            </form>

            @if (Model.GroupsOfCurrentUser != null && Model.GroupsOfCurrentUser.Any())
            {
                <div class="my-5">
                    <h4 class="abrilFont mb-4">Mina grupper</h4>
                    @foreach (var group in Model.GroupsOfCurrentUser)
                    {
                        <div class="accordion" id="notification-accordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="heading_@group.Id">
                                    <button class="accordion-button collapsed greenBgColor"
                                            type="submit"
                                            data-bs-toggle="collapse"
                                            data-bs-target="#collapse_@group.Id"
                                            aria-expanded="false"
                                            aria-controls="collapse_@group.Id">
                                        <i class="bi bi-circle-fill pinkFontColor p-2"></i>
                                        <span class="fw-bold">@group.Name</span>
                                    </button>
                                </h2>

                                <div id="collapse_@group.Id" class="accordion-collapse collapse greenBgColor" aria-labelledby="heading_@group.Id" data-bs-parent="#notification-accordion">
                                    <div class="accordion-body">
                                        @{
                                            var members = await _groupService.GetMembers(group.Id);
                                            await Html.RenderPartialAsync("_MemberPartial", members);
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>


                <form method="post" asp-page-handler="AddUserToGroup">
                    <label class="form-label abrilFont">Lägg till medlem i grupp</label>
                    <div class="d-flex w-50 gap-2">
                        @* TODO: Fixa requiered på selectlist *@
                        <select class="form-control col bg-transparent" asp-for="NewUserGroup.GroupId" asp-items="ViewBag.GroupId" required>
                            <option disabled selected>Välj grupp</option>
                        </select>
                        <select class="form-control col bg-transparent inline-block" asp-for="NewUserGroup.UserId" asp-items="ViewBag.UserId" required>
                            <option disabled selected>Välj medlem</option>
                        </select>
                    </div>
                    <input type="submit" class="btn pinkBgColor my-2 fw-bold" value="Spara" />
                </form>
            }
        </div>
    </div>
    <partial name="Shared/_FooterQuote"/>
}